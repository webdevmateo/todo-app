<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Udacity Todos Goals</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.7.2/redux.min.js"></script>
  </head>
  <body>

    <div>
      <h1>Todo List</h1>
      <input type="text" id="todo" placeholder="Add Todo">
      <button id="todoBtn">Add Todo</button>
      <ul id="todos"></ul>
    </div>
    <div>
      <h1>Goals</h1>
      <input type="text" id="goal" placeholder="Add Goal">
      <button id="goalBtn">Add Goal</button>
      <ul id="goals"></ul>
    </div>
    <script type="text/javascript">

      //App code

      function addTodoAction (todo) {
        const ADD_TODO = 'ADD_TODO';
        return {
          type: ADD_TODO,
          todo,
        }
      }

      function removeTodoAction (id) {
        const REMOVE_TODO = 'REMOVE_TODO';
        return {
          type: REMOVE_TODO,
          id,
        }
      }

      function toggleTodoAction (id) {
        const TOGGLE_TODO = 'TOGGLE_TODO';
        return {
          type: TOGGLE_TODO,
          id,
        }
      }

      function addGoalAction (goal) {
        const ADD_GOAL = 'ADD_GOAL';
        return {
          type: ADD_GOAL,
          goal,
        }
      }

      function removeGoalAction (id) {
        const REMOVE_GOAL = 'REMOVE_GOAL';
        return {
          type: REMOVE_GOAL,
          id,
        }
      }

      function todos (state = [], action) {
        const ADD_TODO = 'ADD_TODO';
        const REMOVE_TODO = 'REMOVE_TODO';
        const TOGGLE_TODO = 'TOGGLE_TODO';
        switch (action.type) {
          case ADD_TODO:
            return state.concat([action.todo]);
          case REMOVE_TODO:
            return state.filter((todo) => todo.id !== action.id);
          case TOGGLE_TODO:
            return state.map((todo) => todo.id !== action.id ? todo : Object.assign({}, todo, {complete: !todo.complete}));
          default:
            return state;
        }
      }

      function goals(state = [], action) {
        const ADD_GOAL = 'ADD_GOAL';
        const REMOVE_GOAL = 'REMOVE_GOAL';
        switch (action.type) {
          case ADD_GOAL:
            return state.concat([action.goal]);
          case REMOVE_GOAL:
            return state.filter((goal) => goal.id !== action.id);
          default:
            return state;
        }
      }

      const store = (Redux.createStore)(Redux.combineReducers({
        todos,
        goals,
      }));

      //DOM Code

      (function addTodo () {
        const todoBtn = document.getElementById('todoBtn');
        let id = 0;
        todoBtn.addEventListener('click', () => {
          const input = document.getElementById('todo');
          if (input.value) {
            store.dispatch(addTodoAction({
              id,
              name: input.value,
              complete: false,
            }));
            id += 1;
            input.value = '';
          }
        });
      })();

      (function addGoal () {
        const goalBtn = document.getElementById('goalBtn');
        let id = 0;
        goalBtn.addEventListener('click', () => {
          const input = document.getElementById('goal');
          if (input.value) {
            store.dispatch(addGoalAction({
              id,
              name: input.value,
            }));
            id += 1;
            input.value = '';
          }
        });
      })();

      function createRemoveButton (onClick) {
        const button = document.createElement('button');
        button.innerHTML = 'X';
        button.addEventListener('click', onClick);
        return button;
      }

      function populateTodoList (todo) {
        const node = document.createElement('li');
        const text = document.createTextNode(todo.name);
        const removeBtn = createRemoveButton(() => {
          store.dispatch(removeTodoAction(todo.id));
        })
        node.appendChild(text);
        node.appendChild(removeBtn);
        const list = document.getElementById('todos');
        list.appendChild(node);
        node.style.textDecoration = todo.complete ? 'line-through' : 'none';
        node.addEventListener('click', () => {
          store.dispatch(toggleTodoAction(todo.id));
        });
      }

      function populateGoalList (goal) {
        const node = document.createElement('li');
        const text = document.createTextNode(goal.name);
        const removeBtn = createRemoveButton(() => {
          store.dispatch(removeGoalAction(goal.id));
        })
        node.appendChild(text);
        node.appendChild(removeBtn);
        const list = document.getElementById('goals');
        list.appendChild(node);
      }

      store.subscribe(() => {
          const {todos, goals} = store.getState();

          document.getElementById('todos').innerHTML = '';
          document.getElementById('goals').innerHTML = '';

          todos.forEach(populateTodoList);
          goals.forEach(populateGoalList);
      });
    </script>
  </body>
</html>
